---
description: 
globs: 
alwaysApply: false
---
# Advanced Product Shipping Restrictions Plugin Rules

## Always update [apparc.md](mdc:apparc.md) after any code changes!

## Overview
This plugin restricts WooCommerce products and variations from being shipped to specific states, cities, or zip codes based on configurable rules. It is designed for compatibility with modern WooCommerce (including HPOS) and WordPress plugin standards.

## File Structure
- Main entry point: [simplified-product-shipping-restrictions.php](mdc:simplified-product-shipping-restrictions.php)
- All logic is encapsulated in the `Simplified_Product_Shipping_Restrictions` class.

## WordPress Plugin Standards
- Follows [WordPress Plugin Guidelines](mdc:https:/developer.wordpress.org/plugins/wordpress-org/detailed-plugin-guidelines):
  - GPLv2 or later license.
  - Human-readable code, no obfuscation.
  - No tracking or external code execution without consent.
  - Stable version and changelog required for releases.
  - Main file named after the plugin directory.
  - Text domain matches plugin directory for i18n.
  - Prevents direct file access with `defined('ABSPATH') || exit;`.
- Settings and options are registered using the WordPress Settings API.
- Admin UI is added as a WooCommerce submenu.

## WooCommerce Plugin Standards
- Follows [WooCommerce Plugin Development Docs](mdc:https:/woocommerce.com/document/create-a-plugin):
  - Uses WooCommerce hooks for admin and frontend integration.
  - Checks for WooCommerce activation before running logic.
  - Uses WooCommerce product/variation meta for restriction data.
  - Uses WordPress actions/filters for extensibility.
  - Separates business logic (restriction checks) from presentation (admin UI).
  - All user-facing strings are translatable.
- HPOS (High-Performance Order Storage) compatibility is declared via `FeaturesUtil::declare_compatibility('custom_order_tables', ...)`.

## HPOS Compatibility
- The plugin declares HPOS compatibility in the `before_woocommerce_init` action.
- No direct queries to legacy order tables; relies on WooCommerce APIs for order/cart access.
- Safe for use in stores with HPOS enabled ([HPOS announcement](mdc:https:/woocommerce.com/posts/platform-update-high-performance-order-storage-for-woocommerce)).

## Coding Best Practices
- All logic is encapsulated in a singleton class.
- Constants are defined for plugin paths and versioning.
- Sanitization and validation are applied to all user input.
- Uses WordPress and WooCommerce APIs for all data access and manipulation.
- No custom database tables are created; all data is stored as post meta or options.
- Inline documentation and docblocks are present for all public methods.

## Extensibility
- Hooks and filters are used for integration points.
- Developers can override or extend restriction logic via WooCommerce hooks.

## Testing & Maintenance
- Designed for compatibility with WooCommerce 5.0+ and WordPress 5.6+.
- Should be tested in both HPOS and legacy order table environments before release.
- All changes should be documented in a `changelog.txt` file as per WooCommerce standards.

## References
- [WooCommerce Plugin Developer Handbook](mdc:https:/woocommerce.com/document/create-a-plugin)
- [WordPress Plugin Guidelines](mdc:https:/developer.wordpress.org/plugins/wordpress-org/detailed-plugin-guidelines)
- [HPOS Platform Update](mdc:https:/woocommerce.com/posts/platform-update-high-performance-order-storage-for-woocommerce)
